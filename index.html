<html>

<head>
      
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        <meta http-equiv="Access-Control-Allow-Origin" content="*"/>
       <meta http-equiv="Access-Control-Allow-Methods" content="GET, POST, OPTIONS"/>
    <meta http-equiv="Access-Control-Allow-Credentials" content="true"/>

           

    </head>
<style>
BODY {
                
 background: url(//beta.snowshoestamp.com/static/demo/img/character_stamp_screen.png) no-repeat center center fixed;
                -webkit-background-size: cover;
                -moz-background-size: cover;
                -o-background-size: cover;
                background-size: cover;
        

}
</style>
<body>



<script type="text/javascript" src="//beta.snowshoestamp.com/static/api/js/sss.client.js"></script>

<script type="text/javascript" src="//beta.snowshoestamp.com/static/core/js/jquery/2.0.0/jquery.min.js"></script>
    <script type="text/javascript" src="//beta.snowshoestamp.com/static/core/js/jquery/jquery.json-2.4.min.js"></script>
    <script type="text/javascript" src="//beta.snowshoestamp.com/static/api/js/vendor/touchy.js"></script>
    
    <script type="text/javascript" src="//beta.snowshoestamp.com/static/api/js/sss.util.js"></script>
    <script src="https://cdn.firebase.com/js/client/1.0.24/firebase.js"></script>
<script>
body = document.getElementsByTagName("body")[0];
Touchy(body, {
    
    five: function (hand, finger1, finger2, finger3, finger4, finger5) {
        hand.on('start', function (points) {
            data=[];
            for(x in points){
                data[x] = [points[x]["x"], points[x]["y"]]; 
            }
            //The URL below should point to a page that uses one of SnowShoe's SDKs to validate the stamp.
            //The current page will redirect to that page upon stamp detection.
            
            call_client(data);
        });
    }

});

var call_again = true;
function call_client(data){
    if(call_again){
    sss.client.init("/demo/set-firebase/"); 
    sss.client.ajax(data, success, fail);
    call_again = false;
    setTimeout(function(){call_again = true;}, 600);
    }
}


var last_time_sword;
var last_time_mace;
var current_item;

function success(data){

    if(data['item'] == "mace"){
        last_time_mace = data["date"];
        current_item = "mace";
        $("body").css("background-image", "url(http://beta.snowshoestamp.com/static/demo/img/character_mace.png)");
    }
    if(data['item'] == "sword"){
        last_time_sword = data["date"];
        current_item = "sword";
        $("body").css("background-image", "url(http://beta.snowshoestamp.com/static/demo/img/character_sword.png)");
    }
}
//called to reset the screen

function fail(data){
    if(data['item'] == "mace"){
        if(current_item == "sword"){
            return;
        }
    }
    if(data['item']=="sword"){
        if(current_item == "mace"){
            return;
        }
    }
    $("body").css("background-image", "url(http://beta.snowshoestamp.com/static/demo/img/character_stamp_screen.png)");
}

var maceRef = new Firebase('https://boiling-fire-3755.firebaseio.com/mace/');
maceRef.on('child_added', function(snapshot) {
  if(snapshot.val() === null) {
    alert("No owner");
  } else {
    if(snapshot.val()!=last_time_mace){
        fail({"item":"mace", "date":snapshot.val()});
    }else{
        success({"item":"mace", "date":snapshot.val()});
    }
  }
});

var swordRef = new Firebase('https://boiling-fire-3755.firebaseio.com/sword/');
swordRef.on('child_added', function(snapshot) {
  if(snapshot.val() === null) {
    alert("No owner");
  } else {
    if(snapshot.val()!=last_time_sword){
        fail({"item":"sword", "date":snapshot.val()});
    }else{
        success({"item":"sword", "date":snapshot.val()});
    }
  }
});

 
</script>
</body>
</html>